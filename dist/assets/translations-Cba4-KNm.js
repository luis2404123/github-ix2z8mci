import{s as c,A as d}from"./auth-ukEJXvp4.js";/* empty css                  */const y=[{code:"en",name:"English"},{code:"es",name:"Spanish"},{code:"fr",name:"French"},{code:"de",name:"German"},{code:"it",name:"Italian"},{code:"pt",name:"Portuguese"},{code:"ru",name:"Russian"},{code:"zh",name:"Chinese"},{code:"ja",name:"Japanese"},{code:"ko",name:"Korean"}];function w(){const o=document.getElementById("source-language"),r=document.getElementById("target-language");if(!o||!r)return;const e=y.map(t=>`<option value="${t.code}">${t.name}</option>`).join("");o.innerHTML='<option value="">Select language</option>'+e,r.innerHTML='<option value="">Select language</option>'+e}async function E(o,r){try{const e=`documents/${r}/${Date.now()}-${o.name}`,{data:t,error:n}=await c.storage.from("documents").upload(e,o);if(n)throw n;return{path:t.path,name:o.name,error:null}}catch(e){return console.error("Error uploading file:",e),{path:null,name:null,error:e.message}}}function T(){const o=document.getElementById("document"),r=document.getElementById("file-preview");!o||!r||o.addEventListener("change",e=>{const t=e.target.files[0];t&&(r.innerHTML=`
      <div class="file-info">
        <span class="material-symbols-outlined">description</span>
        <span>${t.name}</span>
        <small>(${(t.size/1024).toFixed(2)} KB)</small>
      </div>
    `)})}const g={provider:"perplexity",model:"pplx-7b-chat",temperature:.3};var S={VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhmcG9yaXlocmZxaHFnbXZrZnN1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzU4MTI1NTEsImV4cCI6MjA1MTM4ODU1MX0.ppErrWGHZt19wQygk2avi2b8zP0x1-I4S9JU-JSazl8",VITE_SUPABASE_URL:"https://hfporiyhrfqhqgmvkfsu.supabase.co",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const I="https://api.perplexity.ai/chat/completions";async function v(o,r,e){try{const t=await fetch(I,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${S.VITE_PERPLEXITY_API_KEY}`},body:JSON.stringify({model:g.model,messages:[{role:"system",content:`You are a professional translator. Translate the following text from ${r} to ${e}. Maintain the original formatting and structure.`},{role:"user",content:o}],temperature:g.temperature})});if(!t.ok)throw new Error(`Perplexity API error: ${t.statusText}`);return{translatedText:(await t.json()).choices[0].message.content,error:null}}catch(t){return console.error("Perplexity translation error:",t),{translatedText:null,error:t.message}}}async function L(o,r,e){try{return await v(o,r,e)}catch(t){return console.error("Translation service error:",t),{translatedText:null,error:"Translation failed. Please try again."}}}async function _(o,r,e){try{const{data:t,error:n}=await c.from("documents").insert({user_id:o,name:r,file_url:e}).select().single();if(n)throw console.error("Document record error:",n),n;return{data:t,error:null}}catch(t){return console.error("Error creating document record:",t),{data:null,error:t.message||"Error creating document record"}}}class h{static async createTranslation({userId:r,filePath:e,fileName:t,sourceLanguage:n,targetLanguage:a}){try{const{data:s,error:i}=await _(r,t,e);if(i)throw i;const{data:l,error:u}=await c.from("translations").insert({user_id:r,document_id:s.id,source_language:n,target_language:a,status:"pending"}).select().single();if(u)throw u;return this.processTranslation(l.id,e,n,a),{data:l,error:null}}catch(s){return console.error("Error creating translation:",s),{data:null,error:s.message}}}static async processTranslation(r,e,t,n){try{const{data:a}=await c.storage.from("documents").download(e);if(!a)throw new Error("Could not download file");const s=await a.text(),{translatedText:i,error:l}=await L(s,t,n);if(l)throw new Error(l);await this.updateTranslationStatus(r,"completed",i)}catch(a){console.error("Translation processing error:",a),await this.updateTranslationStatus(r,"failed",null,a.message)}}static async updateTranslationStatus(r,e,t=null,n=null){const a={status:e,...t&&{translated_text:t},...n&&{error_message:n}};await c.from("translations").update(a).eq("id",r)}static async getTranslations(){try{const{data:{user:r}}=await c.auth.getUser();if(!r)throw new Error("User not authenticated");const{data:e,error:t}=await c.from("translations").select(`
          *,
          documents (name)
        `).eq("user_id",r.id).order("created_at",{ascending:!1});if(t)throw t;return e.map(n=>({...n,document_name:n.documents.name}))}catch(r){return console.error("Error fetching translations:",r),[]}}}function C(o,r){const e=document.getElementById(o),t=document.getElementById(r),n=e==null?void 0:e.querySelector(".close-btn");!e||!t||!n||(t.addEventListener("click",()=>{e.style.display="block"}),n.addEventListener("click",()=>{e.style.display="none"}),window.addEventListener("click",a=>{a.target===e&&(e.style.display="none")}))}class x{constructor(){this.init()}async init(){const{user:r,error:e}=await d.getCurrentUser();if(e||!r){window.location.href="/Login/login.html";return}this.initializeComponents(),this.initializeEventListeners(),this.loadTranslations()}initializeComponents(){w(),T(),C("translation-modal","new-translation-btn")}initializeEventListeners(){var n;const r=document.getElementById("translation-form");r==null||r.addEventListener("submit",a=>this.handleSubmit(a));const e=document.querySelector(".search-input"),t=document.querySelector(".filter-select");e==null||e.addEventListener("input",()=>this.filterTranslations()),t==null||t.addEventListener("change",()=>this.filterTranslations()),(n=document.getElementById("logout-btn"))==null||n.addEventListener("click",async()=>{const{error:a}=await d.signOut();a||(window.location.href="/Login/login.html")})}async handleSubmit(r){r.preventDefault();const e=r.target,t=e.querySelector("#document"),n=e.querySelector("#source-language").value,a=e.querySelector("#target-language").value;if(t.files[0])try{const{user:s}=await d.getCurrentUser(),i=await E(t.files[0],s.id);if(i.error)throw new Error(i.error);const l=await h.createTranslation({userId:s.id,filePath:i.path,fileName:i.name,sourceLanguage:n,targetLanguage:a});if(l.error)throw new Error(l.error);document.getElementById("translation-modal").style.display="none",e.reset(),this.loadTranslations()}catch(s){console.error("Error creating translation:",s)}}async loadTranslations(){try{const r=await h.getTranslations();this.renderTranslations(r)}catch(r){console.error("Error loading translations:",r)}}renderTranslations(r){const e=document.getElementById("translations-list");e&&(e.innerHTML=r.length?"":"<p>No translations found</p>",r.forEach(t=>{const n=document.createElement("div");n.className="translation-item",n.innerHTML=`
        <div class="translation-info">
          <h3 class="translation-title">${t.document_name}</h3>
          <p class="translation-meta">
            ${t.source_language} â†’ ${t.target_language}
            <br>
            <small>Created: ${new Date(t.created_at).toLocaleString()}</small>
          </p>
        </div>
        <span class="translation-status status-${t.status.toLowerCase()}">
          ${t.status}
        </span>
      `,e.appendChild(n)}))}filterTranslations(){var n,a;const r=((n=document.querySelector(".search-input"))==null?void 0:n.value.toLowerCase())||"",e=((a=document.querySelector(".filter-select"))==null?void 0:a.value)||"all";document.querySelectorAll(".translation-item").forEach(s=>{var m,p;const i=((m=s.querySelector(".translation-title"))==null?void 0:m.textContent.toLowerCase())||"",l=((p=s.querySelector(".translation-status"))==null?void 0:p.textContent.toLowerCase())||"",u=i.includes(r),f=e==="all"||l===e;s.style.display=u&&f?"flex":"none"})}}document.addEventListener("DOMContentLoaded",()=>{new x});
